<?php
$this->headTitle($titulo);
?>
<style>
    .form-page {
        animation: fadeInUp 0.8s ease-out;
    }
    
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .form-card {
        border: none;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        transition: all 0.4s ease;
        background: white;
    }
    
    .form-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    }
    
    .form-header {
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
        padding: 2rem 1.5rem;
        color: white;
        position: relative;
        overflow: hidden;
    }
    
    .form-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, transparent 50%, rgba(255,255,255,0.1) 100%);
        transform: translateX(-100%);
        transition: transform 0.6s ease;
    }
    
    .form-header:hover::before {
        transform: translateX(100%);
    }
    
    .form-title {
        font-size: 2.2rem;
        font-weight: 800;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        animation: titleGlow 3s ease-in-out infinite alternate;
    }
    
    @keyframes titleGlow {
        from {
            text-shadow: 0 0 20px rgba(255,255,255,0.5);
        }
        to {
            text-shadow: 0 0 30px rgba(255,255,255,0.8);
        }
    }
    
    .form-title i {
        font-size: 2.5rem;
        animation: bounce 2s infinite;
    }
    
    @keyframes bounce {
        0%, 20%, 50%, 80%, 100% {
            transform: translateY(0);
        }
        40% {
            transform: translateY(-8px);
        }
        60% {
            transform: translateY(-4px);
        }
    }
    
    .form-subtitle {
        font-size: 1.1rem;
        opacity: 0.95;
        margin: 0;
        animation: fadeIn 1s ease-out 0.3s both;
    }
    
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 0.95;
            transform: translateY(0);
        }
    }
    
    .back-button {
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        border-radius: 8px;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        background: rgba(255,255,255,0.2);
        border: 2px solid rgba(255,255,255,0.3);
        color: white;
        text-decoration: none;
    }
    
    .back-button:hover {
        background: rgba(255,255,255,0.3);
        border-color: rgba(255,255,255,0.5);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }
    
    .form-body {
        padding: 3rem 2rem;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    }
    
    .form-modern {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        animation: slideInUp 0.6s ease-out 0.2s both;
    }
    
    @keyframes slideInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .form-group-modern {
        margin-bottom: 1.5rem;
        animation: fadeInUp 0.6s ease-out;
        animation-fill-mode: both;
    }
    
    .form-group-modern:nth-child(1) { animation-delay: 0.1s; }
    .form-group-modern:nth-child(2) { animation-delay: 0.2s; }
    .form-group-modern:nth-child(3) { animation-delay: 0.3s; }
    .form-group-modern:nth-child(4) { animation-delay: 0.4s; }
    .form-group-modern:nth-child(5) { animation-delay: 0.5s; }
    
    .form-label-modern {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .form-label-modern i {
        color: #007bff;
        font-size: 1.1rem;
    }
    
    .form-control-modern {
        border: 2px solid #e9ecef;
        border-radius: 8px;
        padding: 0.75rem 1rem;
        font-size: 1rem;
        transition: all 0.3s ease;
        background: #f8f9fa;
    }
    
    .form-control-modern:focus {
        border-color: #007bff;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        outline: none;
        background: white;
    }
    
    .form-control-modern.is-invalid {
        border-color: #dc3545;
        box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
    }
    
    .form-control-modern.is-valid {
        border-color: #28a745;
        box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
    }
    
    .invalid-feedback {
        display: block;
        width: 100%;
        margin-top: 0.25rem;
        font-size: 0.875rem;
        color: #dc3545;
        animation: shake 0.5s ease-in-out;
    }
    
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
    }
    
    .valid-feedback {
        display: block;
        width: 100%;
        margin-top: 0.25rem;
        font-size: 0.875rem;
        color: #28a745;
    }
    
    .btn-modern {
        padding: 0.75rem 2rem;
        font-weight: 600;
        border-radius: 8px;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        text-decoration: none;
        border: none;
        position: relative;
        overflow: hidden;
    }
    
    .btn-modern::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        transition: left 0.5s ease;
    }
    
    .btn-modern:hover::before {
        left: 100%;
    }
    
    .btn-modern:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }
    
    .btn-primary-modern {
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
        color: white;
    }
    
    .btn-primary-modern:hover {
        background: linear-gradient(135deg, #0056b3 0%, #004085 100%);
        color: white;
    }
    
    .btn-secondary-modern {
        background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        color: white;
    }
    
    .btn-secondary-modern:hover {
        background: linear-gradient(135deg, #495057 0%, #343a40 100%);
        color: white;
    }
    
    .form-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin-top: 2rem;
        animation: slideInUp 0.6s ease-out 0.6s both;
    }
    
    .alert-modern {
        border: none;
        border-radius: 12px;
        padding: 1.25rem 1.5rem;
        margin-bottom: 2rem;
        animation: slideInLeft 0.6s ease-out 0.1s both;
    }
    
    .alert-info-modern {
        background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
        border-left: 4px solid #17a2b8;
        color: #0c5460;
    }
    
    .alert-success-modern {
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        border-left: 4px solid #28a745;
        color: #155724;
    }
    
    .alert-danger-modern {
        background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        border-left: 4px solid #dc3545;
        color: #721c24;
    }
    
    .alert-modern i {
        font-size: 1.2rem;
        margin-right: 0.5rem;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0%, 100% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.1);
        }
    }
    
    .footer-section {
        animation: fadeIn 1s ease-out 0.8s both;
        margin-top: 2rem;
        padding: 1.5rem;
        background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        border-radius: 12px;
        color: white;
        text-align: center;
    }
    
    .footer-text {
        margin: 0;
        font-size: 1rem;
        opacity: 0.9;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
    }
    
    .footer-text i {
        color: #28a745;
        animation: pulse 2s infinite;
    }
    
    @media (max-width: 768px) {
        .form-title {
            font-size: 1.8rem;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .form-title i {
            font-size: 2rem;
        }
        
        .form-subtitle {
            font-size: 1rem;
        }
        
        .form-body {
            padding: 2rem 1rem;
        }
        
        .form-modern {
            padding: 1.5rem;
        }
        
        .form-actions {
            flex-direction: column;
            align-items: center;
        }
    }
</style>

<div class="form-page">
    <div class="row justify-content-center">
        <div class="col-12 col-lg-8">
            <div class="card form-card">
                <!-- Header mejorado -->
                <div class="form-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h1 class="form-title">
                                <i class="fas fa-user-plus"></i>
                                <?= $this->escapeHtml($titulo) ?>
                            </h1>
                            <p class="form-subtitle"><?= $this->escapeHtml($subtitulo) ?></p>
                        </div>
                        <a href="/estudiante" class="back-button">
                            <i class="fas fa-arrow-left"></i>
                            Volver
                        </a>
                    </div>
                </div>
                
                <!-- Body del formulario -->
                <div class="form-body">
                    <!-- Mensajes de error -->
                    <?php if (isset($errors) && !empty($errors)): ?>
                        <div class="alert alert-danger-modern alert-modern">
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>Por favor corrija los siguientes errores:</strong>
                            <ul class="mb-0 mt-2">
                                <?php foreach ($errors as $error): ?>
                                    <li><?= $this->escapeHtml($error) ?></li>
                                <?php endforeach; ?>
                            </ul>
                        </div>
                    <?php endif; ?>
                    
                    <!-- Alert informativo -->
                    <div class="alert alert-info-modern alert-modern">
                        <i class="fas fa-info-circle"></i>
                        <?= $this->escapeHtml($mensaje) ?>
                    </div>
                    
                    <!-- Formulario -->
                    <div class="form-modern">
                        <form id="estudianteForm" method="POST" action="/estudiante/guardar">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group-modern">
                                        <label for="nombre" class="form-label-modern">
                                            <i class="fas fa-user"></i>
                                            Nombre Completo
                                        </label>
                                        <input type="text" 
                                               class="form-control form-control-modern" 
                                               id="nombre" 
                                               name="nombre" 
                                               value="<?= isset($formData['nombre']) ? $this->escapeHtml($formData['nombre']) : '' ?>"
                                               placeholder="Ingrese el nombre completo"
                                               required>
                                        <div class="invalid-feedback" style="display: none;">
                                            Por favor ingrese un nombre válido.
                                        </div>
                                        <div class="valid-feedback" style="display: none;">
                                            ¡Perfecto!
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="form-group-modern">
                                        <label for="carrera" class="form-label-modern">
                                            <i class="fas fa-graduation-cap"></i>
                                            Carrera
                                        </label>
                                        <select class="form-control form-control-modern" 
                                                id="carrera" 
                                                name="carrera" 
                                                required>
                                            <option value="">Seleccione una carrera</option>
                                            <option value="Ingeniería de Sistemas">Ingeniería de Sistemas</option>
                                            <option value="Ingeniería Informática">Ingeniería Informática</option>
                                            <option value="Ciencias de la Computación">Ciencias de la Computación</option>
                                            <option value="Ingeniería de Software">Ingeniería de Software</option>
                                            <option value="Tecnología de la Información">Tecnología de la Información</option>
                                        </select>
                                        <div class="invalid-feedback" style="display: none;">
                                            Por favor seleccione una carrera.
                                        </div>
                                        <div class="valid-feedback" style="display: none;">
                                            ¡Excelente elección!
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group-modern">
                                        <label for="semestre" class="form-label-modern">
                                            <i class="fas fa-calendar-alt"></i>
                                            Semestre
                                        </label>
                                        <select class="form-control form-control-modern" 
                                                id="semestre" 
                                                name="semestre" 
                                                required>
                                            <option value="">Seleccione el semestre</option>
                                            <option value="1ro">1er Semestre</option>
                                            <option value="2do">2do Semestre</option>
                                            <option value="3ro">3er Semestre</option>
                                            <option value="4to">4to Semestre</option>
                                            <option value="5to">5to Semestre</option>
                                            <option value="6to">6to Semestre</option>
                                            <option value="7mo">7mo Semestre</option>
                                            <option value="8vo">8vo Semestre</option>
                                            <option value="9no">9no Semestre</option>
                                            <option value="10mo">10mo Semestre</option>
                                        </select>
                                        <div class="invalid-feedback" style="display: none;">
                                            Por favor seleccione el semestre.
                                        </div>
                                        <div class="valid-feedback" style="display: none;">
                                            ¡Perfecto!
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="form-group-modern">
                                        <label for="email" class="form-label-modern">
                                            <i class="fas fa-envelope"></i>
                                            Email
                                        </label>
                                        <input type="email" 
                                               class="form-control form-control-modern" 
                                               id="email" 
                                               name="email" 
                                               placeholder="correo@ejemplo.com"
                                               required>
                                        <div class="invalid-feedback" style="display: none;">
                                            Por favor ingrese un email válido.
                                        </div>
                                        <div class="valid-feedback" style="display: none;">
                                            ¡Email válido!
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group-modern">
                                        <label for="telefono" class="form-label-modern">
                                            <i class="fas fa-phone"></i>
                                            Teléfono
                                        </label>
                                        <input type="tel" 
                                               class="form-control form-control-modern" 
                                               id="telefono" 
                                               name="telefono" 
                                               placeholder="+591 7XXXXXXXX"
                                               pattern="[0-9\+\s\-]+">
                                        <div class="invalid-feedback" style="display: none;">
                                            Por favor ingrese un teléfono válido.
                                        </div>
                                        <div class="valid-feedback" style="display: none;">
                                            ¡Teléfono válido!
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="form-group-modern">
                                        <label for="ci" class="form-label-modern">
                                            <i class="fas fa-id-card"></i>
                                            C.I.
                                        </label>
                                        <input type="text" 
                                               class="form-control form-control-modern" 
                                               id="ci" 
                                               name="ci" 
                                               placeholder="12345678"
                                               pattern="[0-9]+"
                                               maxlength="10">
                                        <div class="invalid-feedback" style="display: none;">
                                            Por favor ingrese un C.I. válido (solo números).
                                        </div>
                                        <div class="valid-feedback" style="display: none;">
                                            ¡C.I. válido!
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Botones de acción -->
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary-modern btn-modern form-submit-btn">
                                    <i class="fas fa-save"></i>
                                    Guardar Estudiante
                                </button>
                                <a href="/estudiante" class="btn btn-secondary-modern btn-modern">
                                    <i class="fas fa-times"></i>
                                    Cancelar
                                </a>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Footer -->
                    <div class="footer-section">
                        <p class="footer-text">
                            <i class="fas fa-graduation-cap"></i>
                            Sistema de Gestión de Estudiantes - Laminas Framework
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Validación en tiempo real
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('estudianteForm');
        const inputs = form.querySelectorAll('.form-control-modern');
        
        // Validación en tiempo real
        inputs.forEach(input => {
            input.addEventListener('blur', function() {
                validateField(this);
            });
            
            input.addEventListener('input', function() {
                if (this.classList.contains('is-invalid')) {
                    validateField(this);
                }
            });
        });
        
        // Validación del formulario
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            let isValid = true;
            inputs.forEach(input => {
                if (!validateField(input)) {
                    isValid = false;
                }
            });
            
            if (isValid) {
                // Mostrar loading y enviar formulario
                const submitBtn = form.querySelector('button[type="submit"]');
                if (submitBtn) {
                    const originalText = submitBtn.innerHTML;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Guardando...';
                    submitBtn.disabled = true;
                }
                
                // Enviar formulario después de un breve delay para mostrar el loading
                setTimeout(() => {
                    form.submit();
                }, 500);
            } else {
                showErrorMessage();
            }
        });
        
        function validateField(field) {
            const value = field.value.trim();
            let isValid = true;
            const invalidFeedback = field.parentNode.querySelector('.invalid-feedback');
            const validFeedback = field.parentNode.querySelector('.valid-feedback');
            
            // Ocultar ambos mensajes primero
            if (invalidFeedback) invalidFeedback.style.display = 'none';
            if (validFeedback) validFeedback.style.display = 'none';
            
            // Limpiar clases anteriores
            field.classList.remove('is-valid', 'is-invalid');
            
            // Validaciones específicas
            if (field.hasAttribute('required') && !value) {
                isValid = false;
            } else if (field.type === 'email' && value && !isValidEmail(value)) {
                isValid = false;
            } else if (field.type === 'tel' && value && !isValidPhone(value)) {
                isValid = false;
            } else if (field.name === 'ci' && value && !isValidCI(value)) {
                isValid = false;
            } else if (field.name === 'nombre' && value && value.length < 3) {
                isValid = false;
            } else if (field.name === 'carrera' && !value) {
                isValid = false;
            } else if (field.name === 'semestre' && !value) {
                isValid = false;
            }
            
            // Aplicar clases de validación y mostrar mensajes
            if (value) {
                field.classList.add(isValid ? 'is-valid' : 'is-invalid');
                if (isValid && validFeedback) {
                    validFeedback.style.display = 'block';
                } else if (!isValid && invalidFeedback) {
                    invalidFeedback.style.display = 'block';
                }
            }
            
            return isValid;
        }
        
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
        
        function isValidPhone(phone) {
            const phoneRegex = /^[\+]?[0-9\s\-\(\)]{7,15}$/;
            return phoneRegex.test(phone);
        }
        
        function isValidCI(ci) {
            const ciRegex = /^[0-9]{7,10}$/;
            return ciRegex.test(ci);
        }
        
        function showSuccessMessage() {
            const alert = document.querySelector('.alert-modern');
            alert.className = 'alert alert-success-modern alert-modern';
            alert.innerHTML = '<i class="fas fa-check-circle"></i> ¡Estudiante guardado exitosamente! Redirigiendo...';
            
            setTimeout(() => {
                window.location.href = '/estudiante';
            }, 2000);
        }
        
        function showErrorMessage() {
            const alert = document.querySelector('.alert-modern');
            alert.className = 'alert alert-danger-modern alert-modern';
            alert.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Por favor corrija los errores en el formulario.';
        }
    });
</script>
